<!DOCTYPE html>
<html>
<head>
<!--<meta charset="utf-8">
    <title>人体BMI指数计算器</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel=stylesheet href=../html/css/base.css>
    <link rel=stylesheet href=../html/css/ui-block.css>  -->
    <meta charset="UTF-8" />
    <meta http-equiv="refresh">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart BMI Calculator</title>
    <meta name="description" content="A smart BMI Calculator which can give you advice." />
    <meta name="keywords" content="bmi,calculator,health,fitness,calory" />
    <meta name="author" content="Thundergrj" />
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" type="text/css" href="css/default.css" />
    <link rel="stylesheet" type="text/css" href="css/component.css" />
    <script src="js/modernizr.custom.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><!--这句是从上面被注掉的代码里面摘出来的-->
</head>

<style>
    input{
        width:300px;
        height:30px;
        border-radius:10px;
        border:2px solid gray;
    }
    button{
        border-radius: 10px;
    }
</style>

<body>
  <!--
  <div align="center">
    < img src="background.png"/>
  </div>
-->
<!--
<h2 class="col">Test for ExtensionWallet</h2>
<p></p >
<div id=send class="container send" >
<h3>1 Send transaction</h3>
<p>1.1 Click this button to see which account is using in ExtensionWallet </p >
    <div>
        <button type="button" id="buttonGetACC" class="btn btn-block" >get account</button>
    </div>
<p id="accountAddress" style="color:#FF0000;font-size:12px;"> </p >

<p>1.2 Input the receive account and amount of this transaction </p >
    <div>
        <label for="inputReceiveAddress">receive address: </label>
        <input id="inputReceiveAddress"  size="35" >
    </div>
    <div>
        <label for="inputAmount">amount in NAS: </label>
        <input id="inputAmount"  size="10" >
    </div>
    <div>
        <button type="button" id="buttonSendTx" class="btn btn-block" >send transaction</button>
    </div>

<h3>2 Call a smart contract</h3>
<p>Input your smart contract address and parameters </p >
<!--
    <div>
        <label for="inputContractAddress">contract address: </label>
        <input id="inputContractAddress" size="35" >
    </div>
    <div>
        <label for="inputFunction">input function name:</label>
        <input id="inputFunction" style="resize:both" >
    </div>
-->
    <div style="background-color:#40B3DF;position: absolute;top:0px;left:0px;right:0px;height:70px">
    <header>
        <h1 style="text-align: center;">BMI Calculator</h1>
    </header>
    </div>
        <p style="background-color:#40B3DF;text-align: center;text-shadow: transparent;position: absolute;top:40px;left:0px;right:0px;height:50px;font-size:25px">
            Smart Enough to Give You Advice
        </p>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>


    <div style="text-align: center">
        <label for="inputParameter1">
        </label>
        <input id="inputParameter1" style="resize:both;text-align: center;" placeholder="Username">
    </div>

    <br>
    <br>

    <div style="text-align: center;">
        <label for="inputParameter2">
        </label>
        <input id="inputParameter2" style="resize:both;text-align: center;" placeholder="Age">
    </div>

    <br>
    <br>

    <div style="text-align: center">
        <label for="inputParameter3">
        </label>
        <input id="inputParameter3" style="resize:both;text-align: center" placeholder="Height">
    </div>

    <br>
    <br>

    <div style="text-align: center;">
        <label for="inputParameter4">
        </label>
        <input id="inputParameter4" style="resize:both;text-align: center;" placeholder="Weight">
    </div>
    <!--<div style="text-indent: 4em;font-size: 20px">
        <button type="button" id="buttonCallDapp" class="btn btn-block" style="background-color: #40B3DF">戳这里</button>
    </div>
    <p style="color:gray;font-size: 12px">The above button using "sendTransaction" rpc</p >
    <br>
    <br>
    <div>
        <button type="button" id="buttonCallTest" class="btn btn-block">查看订单</button>
    </div>

    <p style="color:gray;font-size: 12px">The above button using "call" rpc</p >
    </div>-->


<!--尝试调用弹窗动画-->
        <div class="md-modal md-effect-1" id="modal-1">
            <div class="md-content">
                <h3>Tips</h3>
                <div>
                    <ul>
                        <li id="txResult1"></li>
                        <li id="txResult2"></li>
                        <li id="txResult3"></li>
                    </ul>
                    <button class="md-close">Close me!</button>
                </div>
            </div>
        </div>

        <div class="md-modal md-effect-1" id="modal-2">
            <div class="md-content">
                <h3>Bar Chart</h3>
                <div>
                    <canvas id="myCanvas" width="540" height="400" style="border:5px solid #c3c3c3"></canvas>
                    <button class="md-close">Close me!</button>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="main clearfix">
                <div style="position: absolute;left:575px;">
                    <button class="md-trigger" data-modal="modal-1" id="buttonCallDapp" class="btn btn-block">Estimate</button>
                </div>
                <div style="position: absolute;left:800px;">
                    <button class="md-trigger" data-modal="modal-2" class="btn btn-block">Trendline</button>
                </div>
                <div style="position: absolute;left:350px;">
                    <button class="md-trigger" data-modal="modal-3" id="buttonCallTest" class="btn btn-block">Submit</button>
                </div>
            </div>
        </div>
        <div class="md-overlay"></div><!-- the overlay element -->

        <div style="background-color:#EA0000;text-align:center;position: absolute;left:0px;right:0px;bottom:0px;height:90px;">
            <br>
            <font color="#BEBEBE"><b>Spec: First click SUBMIT, then click ESTIMATE to see tips for you, Finally click TRENDLINE to see your history bar-chart.</b></font>
            <br>
            <br>
            <font color="#BEBEBE"><b>Contact us: thundergrj@icloud.com</b></font>
        </div>




        <!-- classie.js by @desandro: https://github.com/desandro/classie -->
        <script src="js/classie.js"></script>
        <script src="js/modalEffects.js"></script>

        <!-- for the blur effect -->
        <!-- by @derSchepp https://github.com/Schepp/CSS-Filters-Polyfill -->
        <script>
            // this is important for IEs
            var polyfilter_scriptpath = '/js/';
        </script>
        <script src="js/cssParser.js"></script>
        <script src="js/css-filters-polyfill.js"></script>


<script>
    //var bmiArray = new Array();
    /*document.getElementById("buttonGetACC").addEventListener("click",function(){
        console.log("********* get account *****************")
        window.postMessage({
            "target": "contentscript",
            "data":{
            },
            "method": "getAccount",
        }, "*");
    })*/

    /*document.getElementById("buttonSendTx").addEventListener("click",function()
    {
        console.log("********* send transaction *****************")
        //var from = document.getElementById("inputAccountAddress").value
        var to = document.getElementById("inputReceiveAddress").value
        var amount = document.getElementById("inputAmount").value
        window.postMessage({
            "target": "contentscript",
            "data":{
                //"from": from,
                "to": to,
                "value": amount
            },
            "method": "neb_sendTransaction"
        }, "*");
    });*/

    /*document.getElementById("buttonCallDapp").addEventListener("click",function(){
        console.log("********* call smart contract \"sendTransaction\" *****************")
        var to = document.getElementById("inputContractAddress").value
        var func = document.getElementById("inputFunction").value
        var para = "[\"" + document.getElementById("inputParameter").value.trim() + "\"]"

        window.postMessage({
            "target": "contentscript",
            "data":{
                //"from": from,
                "to": to,
                "value": "0",
                "contract":{
                    "function":func,
                    "args":para
                }
            },
            "method": "neb_sendTransaction"
        }, "*");
    })*/
    document.getElementById("buttonCallTest").addEventListener("click",function(){
        console.log("********* call smart contract \"sendTransaction\" *****************")
        var to = "n1upkdbvq1Kjpx8L4R6ZmwaLfgsKfvKPedd"
        var func = "bmi"
        var para = "[\"" + document.getElementById("inputParameter1").value.trim() + "\",\"" + document.getElementById("inputParameter2").value.trim() + "\",\"" + document.getElementById("inputParameter3").value.trim() + "\",\"" + document.getElementById("inputParameter4").value.trim() + "\"]"

        window.postMessage({
            "target": "contentscript",
            "data":{
                //"from": from,
                "to": to,
                "value": "0",
                "contract":{
                    "function":func,
                    "args":para
                }
            },
            "method": "neb_sendTransaction"
        }, "*");
    })

    document.getElementById("buttonCallDapp").addEventListener("click",function(){
        console.log("********* call smart contract by \"call\" *****************")
        var to = "n1upkdbvq1Kjpx8L4R6ZmwaLfgsKfvKPedd";
        var func = "dataOf";
        //var para = "[\"" + document.getElementById("inputParameter").value.trim() + "\"]"

        window.postMessage({
            "target": "contentscript",
            "data":{
                //"from": from,
                "to": to,
                "value": "0",
                "contract":{
                    "function":func,
                    "args":""
                }
            },
            "method": "neb_call"
        }, "*");
    })

    // listen message from contentscript
    window.addEventListener('message', function(e) {
        // e.detail contains the transferred data (can
        console.log("recived by page:" + e + ", e.data:"+ JSON.stringify(e.data));
        if(!!e.data.data.account){
            document.getElementById("accountAddress").innerHTML= "Account address: " + e.data.data.account;
        }
        if(!!e.data.data.receipt){
            //document.getElementById("txResult").innerHTML = "Transaction Receipt\n" +  JSON.stringify(e.data.data.receipt,null,'\t');
            document.getElementById("txResult1").innerHTML = "here should be cut"
        }
        if(!!e.data.data.neb_call){
          var s = JSON.stringify(e.data.data.neb_call);
          var m = JSON.parse(s);
          var bmiArray = new Array();
          bmiArray = m.result;
          var bmi = JSON.parse(bmiArray);
          var myObj = eval(bmi);
          var myObjLast = myObj[myObj.length-1];
          var text1;
          var text2;
          var text3;
          if(myObjLast<18.5)
          {
            text1 = ", a little lower and should add more fat.";
            text2 = "more meats";
            text3 = "more strenth training";
          }
          else if(myObjLast<24)
          {
            text1 = ", standard value, keep it on!";
            text2 = "balance in vegetables and meats.";
            text3 = "balance in strenth training and aebotics";
          }
          else if(myObjLast<28)
          {
            text1 = ", a little higher, more exercise will be better.";
            text2 = "more fruits,vegetables.";
            text3 = "more aebotic exercise.";
          }
          else
          {
            text1 = ", too high, you should strictly control your eating habbit and exercise more!";
            text2 = "water.";
            text3 = "keep jogging.";
          }


          //var obj = eval(s);
          //var obj = JSON.parse(s);
          //var s = JSON.stringify(e.data.data.neb_call);
         // s =  e.data.data.neb_call;
          //var payOrder = s.get(result);
          document.getElementById("txResult1").innerHTML = "<strong>Your BMI</strong>：" + myObjLast;
          document.getElementById("txResult2").innerHTML = "<strong>Diet</strong>：" + text2;
          document.getElementById("txResult3").innerHTML = "<strong>Exercise</strong>：" + text3;
        //document.getElementById("txResult").innerHTML = "return of call\n" +  JSON.stringify(e.data.data.neb_call,null,'\t');


        //绘制柱状图
            /*一 画坐标轴*/
    var l = myObj.length;
    var canvas = document.getElementById('myCanvas');
    var ctx = myCanvas.getContext('2d');
    var width = myCanvas.width;
    var height = myCanvas.height;
    var padding = 50;       // 坐标轴到canvas边框的边距，留边距写文字

    ctx.beginPath();
    ctx.lineWidth = 2;
    ctx.strokeStyle = '#40B3DF';

    // y轴线
    ctx.moveTo(padding + 0.5, height - padding + 0.5);
    ctx.lineTo(padding + 0.5, padding + 0.5);
    ctx.stroke();

    // x轴线
    ctx.moveTo(padding + 0.5, height - padding + 0.5);
    ctx.lineTo(width - padding + 0.5, height - padding + 0.5);
    ctx.stroke();

    /*二 画坐标刻度*/
    var xNumber = 5;                                                             // x轴的段数
    var data = new Array(10,20,30,40,50);
    var ratio = (height-padding*2)/50;                                            //之后注掉
    var yLength = Math.floor((height - padding * 2) / data.length);              // y轴每段的真实长度
    var xLength = Math.floor((width - padding * 2) / xNumber);                   // x轴每段的真实长度

    ctx.beginPath();
    ctx.textAlign = 'center';
    ctx.fillStyle = '#2894FF';
    ctx.strokeStyle = '#2894FF';
    // x轴刻度和值
    for (var i = 0; i < xNumber; i++) {
    var xAxis = i+1;
    var xlen = xLength * (i + 1);
    ctx.moveTo(padding + xlen, height - padding);
    ctx.lineTo(padding + xlen, height - padding + 5);
    ctx.stroke();                                                               // 画轴线上的刻度，就是那一个个小揪揪
    ctx.fillText(xAxis, padding + xlen - xLength / 2, height - padding + 15);   // 填充文字
    }
    // y轴刻度和值
    for (var i = 0; i < data.length; i++) {
    var yAxis = data[i];
    var ylen = yLength * (i + 1);
    ctx.moveTo(padding, height - padding - ylen);
    ctx.lineTo(padding - 5, height - padding - ylen);
    ctx.stroke();
    ctx.fillText(yAxis, padding - 10, height - padding - ylen + 5);
    }

    /*三 画柱状动画*/
    //var bmiArray = new Array(19,23,28,17,20);
    if(l<=5)
    {
        for(var i = 0; i < l; i++)
        {
            var x = (i+1)*xLength-7.5;
            var hei = ratio*myObj[i];
            var y = height-padding-hei;
            ctx.fillRect(x, y, 30, hei);
        }
    }
    else
    {
        for(var i = l-5, j = 0; i<l; i++)
        {
            j++;
            var x = (j)*xLength-7.5;
            var hei = ratio*myObj[i];
            var y = height-padding-hei;
            ctx.fillRect(x, y, 30, hei);
        }
    }

        }
    });

</script>
</body>
</html>
